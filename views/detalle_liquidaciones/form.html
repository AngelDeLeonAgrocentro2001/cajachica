<form id="detalleFormInner" method="POST" enctype="multipart/form-data">
    <!-- Sección: Información General -->
    <details open>
        <summary>Información General</summary>
        <div class="section-content">
            <div class="form-group">
                <label for="id_liquidacion">Liquidación</label>
                <select id="id_liquidacion" name="id_liquidacion" required>
                    <option value="">Selecciona una liquidación</option>
                    {{select_liquidaciones}}
                </select>
                <div class="error" data-field="id_liquidacion"></div>
            </div>
            <div class="form-group">
                <label for="fecha">Fecha</label>
                <input type="date" id="fecha" name="fecha" value="<?php echo isset($data['fecha']) ? htmlspecialchars($data['fecha']) : ''; ?>" required>
                <div class="error" data-field="fecha"></div>
            </div>
            <div class="form-group">
                <label for="estado">Estado</label>
                <select id="estado" name="estado" required>
                    <option value="EN_PROCESO" <?php echo (isset($data['estado']) && $data['estado'] == 'EN_PROCESO') ? 'selected' : ''; ?>>En Proceso</option>
                    <option value="PENDIENTE_AUTORIZACION" <?php echo (isset($data['estado']) && $data['estado'] == 'PENDIENTE_AUTORIZACION') ? 'selected' : ''; ?>>Pendiente Autorización</option>
                    <option value="PENDIENTE_REVISION_CONTABILIDAD" <?php echo (isset($data['estado']) && $data['estado'] == 'PENDIENTE_REVISION_CONTABILIDAD') ? 'selected' : ''; ?>>Pendiente Revisión Contabilidad</option>
                    <option value="FINALIZADO" <?php echo (isset($data['estado']) && $data['estado'] == 'FINALIZADO') ? 'selected' : ''; ?>>Finalizado</option>
                    <option value="DESCARTADO" <?php echo (isset($data['estado']) && $data['estado'] == 'DESCARTADO') ? 'selected' : ''; ?>>Descartado</option>
                </select>
                <div class="error" data-field="estado"></div>
            </div>
        </div>
    </details>

    <!-- Sección: Detalles de la Factura -->
    <details>
        <summary>Detalles de la Factura</summary>
        <div class="section-content">
            <div class="form-group">
                <label for="no_factura">No. Factura</label>
                <input type="text" id="no_factura" name="no_factura" value="<?php echo isset($data['no_factura']) ? htmlspecialchars($data['no_factura']) : ''; ?>" required>
                <div class="error" data-field="no_factura"></div>
            </div>
            <div class="form-group">
                <label for="nombre_proveedor">Nombre del Proveedor</label>
                <input type="text" id="nombre_proveedor" name="nombre_proveedor" value="<?php echo isset($data['nombre_proveedor']) ? htmlspecialchars($data['nombre_proveedor']) : ''; ?>" required>
                <div class="error" data-field="nombre_proveedor"></div>
            </div>
            <div class="form-group">
                <label for="bien_servicio">Bien/Servicio</label>
                <input type="text" id="bien_servicio" name="bien_servicio" value="<?php echo isset($data['bien_servicio']) ? htmlspecialchars($data['bien_servicio']) : ''; ?>" required>
                <div class="error" data-field="bien_servicio"></div>
            </div>
            <div class="form-group">
                <label for="t_gasto">Tipo de Gasto</label>
                <select id="t_gasto" name="t_gasto" required>
                    <option value="">Selecciona un tipo de gasto</option>
                    {{select_tipos_gastos}}
                </select>
                <div class="error" data-field="t_gasto"></div>
            </div>
            <div class="form-group">
                <label for="p_unitario">Precio Unitario</label>
                <input type="number" step="0.01" id="p_unitario" name="p_unitario" value="<?php echo isset($data['p_unitario']) ? htmlspecialchars($data['p_unitario']) : ''; ?>" required>
                <div class="error" data-field="p_unitario"></div>
            </div>
            <div class="form-group">
                <label for="total_factura">Total Factura</label>
                <input type="number" step="0.01" id="total_factura" name="total_factura" value="<?php echo isset($data['total_factura']) ? htmlspecialchars($data['total_factura']) : ''; ?>" required>
                <div class="error" data-field="total_factura"></div>
            </div>
            <div class="form-group">
                <label for="tipo_documento">Tipo de Documento</label>
                <select id="tipo_documento" name="tipo_documento" required>
                    <option value="FACTURA" <?php echo (isset($data['tipo_documento']) && $data['tipo_documento'] == 'FACTURA') ? 'selected' : ''; ?>>Factura</option>
                    <option value="RECIBO" <?php echo (isset($data['tipo_documento']) && $data['tipo_documento'] == 'RECIBO') ? 'selected' : ''; ?>>Recibo</option>
                </select>
                <div class="error" data-field="tipo_documento"></div>
            </div>
            <div class="form-group">
                <label for="nit_proveedor">NIT Proveedor</label>
                <input type="text" id="nit_proveedor" name="nit_proveedor" value="<?php echo isset($data['nit_proveedor']) ? htmlspecialchars($data['nit_proveedor']) : ''; ?>">
                <div class="error" data-field="nit_proveedor"></div>
            </div>
            <div class="form-group">
                <label for="dpi">DPI</label>
                <input type="text" id="dpi" name="dpi" value="<?php echo isset($data['dpi']) ? htmlspecialchars($data['dpi']) : ''; ?>">
                <div class="error" data-field="dpi"></div>
            </div>
            <div class="form-group">
                <label for="id_centro_costo">Centro de Costo</label>
                <input type="number" id="id_centro_costo" name="id_centro_costo" value="<?php echo isset($data['id_centro_costo']) ? htmlspecialchars($data['id_centro_costo']) : ''; ?>">
                <div class="error" data-field="id_centro_costo"></div>
            </div>
            <div class="form-group">
                <label for="cantidad">Cantidad</label>
                <input type="number" id="cantidad" name="cantidad" value="<?php echo isset($data['cantidad']) ? htmlspecialchars($data['cantidad']) : ''; ?>">
                <div class="error" data-field="cantidad"></div>
            </div>
            <div class="form-group">
                <label for="serie">Serie</label>
                <input type="text" id="serie" name="serie" value="<?php echo isset($data['serie']) ? htmlspecialchars($data['serie']) : ''; ?>">
                <div class="error" data-field="serie"></div>
            </div>
        </div>
    </details>

    <!-- Sección: Archivos Adjuntos -->
    <details>
        <summary>Archivos Adjuntos</summary>
        <div class="section-content">
            <div class="form-group">
                <label for="archivos">Subir Archivos</label>
                <input type="file" id="archivos" name="archivos[]" multiple>
                <div class="error" data-field="archivos"></div>
            </div>
            <?php if (isset($data['rutas_archivos']) && !empty($data['rutas_archivos'])): ?>
                <div class="form-group">
                    <label>Archivos Existentes</label>
                    <?php
                    $rutas = is_array($data['rutas_archivos']) ? $data['rutas_archivos'] : json_decode($data['rutas_archivos'], true);
                    if (is_array($rutas) && !empty($rutas)):
                        foreach ($rutas as $ruta):
                    ?>
                        <div>
                            <a href="../<?php echo htmlspecialchars($ruta); ?>" target="_blank">Ver Archivo</a>
                        </div>
                    <?php endforeach; else: ?>
                        <p>No hay archivos adjuntos.</p>
                    <?php endif; ?>
                </div>
            <?php endif; ?>
        </div>
    </details>

    <div class="form-buttons">
        <button type="submit">Guardar</button>
        <button type="button" onclick="closeModal()">Cancelar</button>
    </div>
</form>

<style>
    /* Estilo de las secciones colapsables */
    details {
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: hidden;
    }

    summary {
        background-color: #3498db;
        color: #fff;
        padding: 10px;
        font-weight: 600;
        cursor: pointer;
        outline: none;
        transition: background-color 0.3s ease;
    }

    summary:hover {
        background-color: #2980b9;
    }

    details[open] summary {
        background-color: #2980b9;
    }

    .section-content {
        padding: 15px;
        background-color: #f9f9f9;
    }

    /* Campos del formulario */
    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }

    /* Mensajes de error */
    .error {
        color: #e74c3c;
        font-size: 0.85rem;
        display: none;
    }

    /* Botones */
    .form-buttons {
        text-align: center;
        margin-top: 20px;
    }

    button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    button[type="submit"] {
        background-color: #3498db;
        color: #fff;
    }

    button[type="submit"]:hover {
        background-color: #2980b9;
    }

    button[type="button"] {
        background-color: #e74c3c;
        color: #fff;
        margin-left: 10px;
    }

    button[type="button"]:hover {
        background-color: #c0392b;
    }
</style>